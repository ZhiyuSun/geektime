# 评论系统架构设计

## 功能模块

不要做需求的翻译机

要成为业务领域的专家

发布评论，读取评论，删除评论，管理评论

在动手之前，反复思考，真正编码的时间只有5%

## 架构设计

kafka削峰填谷
查询在es里面查，再二次操作MySQL

comment-service，专注于评论的数据处理

把缓存和消息队列用好，系统提升80%
把上层做好，对存储的依赖就变弱了

## 存储设计

尽可能让主键id自增

评论主体表+评论索引表+评论内容表

按需构建，增量加载

平民版的MySQL+Redis

redis sortedset

## 可用性设计

归并回源

singleflight，解决穿透问题  进程内单飞，不需要分布式锁

进程内的归并投kafka
查mysql之前查redis

## 问题

评论系统架构设计里面，kafka读那一块，如果对于同一条评论，短时间内有大量请求没读到缓存，给kafka传了大量消息，会不会使MySQL压力过高，并且给同一条评论重复写缓存了。



