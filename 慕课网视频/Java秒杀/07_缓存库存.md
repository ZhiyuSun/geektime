# 缓存库存

库存行锁优化：
要加索引，否则会锁表

交易优化方案：
- 获得发布同步库存进缓存
- 下单交易减缓存库存
- 异步消息扣减数据库内库存

分布式事务
ACID(刚性事务)(强一致)
CAP:P一定要容忍
BASE(柔性事务)(最终一致)

问题：
- 异步消息发送失败
- 扣减操作执行失败
- 下单失败无法正确回补库存

