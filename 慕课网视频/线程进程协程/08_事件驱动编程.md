# 事件驱动编程

生成器协程调度器——事件驱动协程调度器

## socket网络编程入门

客户端/服务器模型

clinet——TCP/IP互联网——server

本质上是通过socket通信

socket套接字
- 套接字是抽象概念，表示TCP连接的一端
- 通过套接字可以进行数据发送或接收
- 把IP:Port看成套接字
- 一个TCP连接有两个套接字组成

服务端：
创建套接字——绑定（bind）套接字——监听（listen）套接字——接收&处理信息

客户端：
创建套接字——连接套接字——发送信息

## Linux文件描述符fd

Linux一切皆是文件

文件类型：
- 套接字
- 普通文件
- 目录文件
- 符号链接
- 设备文件
- FIFO

进程级的文件描述符表
系统级的文件描述附表
文件系统的i——Node表

## TCP网络服务器的实现原理

刚刚的实现，处理请求阻塞主线程，效率低下

把代码改造成多线程的实现方式，不阻塞主线程，提升处理效率

利用多线程的方式处理网络请求是一个常见的方案

## Linux网络IO模型详解

阻塞式IO  PIC

非阻塞式IO 

IO多路复用（重点）。一个线程里可以处理多个套接字

信号驱动式IO

异步IO（不是很常用）

## IO多路复用

可以同时监听多个套接字

一个线程里面处理多个套接字

三种方式
- select:线性扫描所有监听的文件描述符fd
- poll:同select,性能有所优化
- epoll:使用红黑树管理数据结构，性能好（性能好，在logn范围里找到操作符）

## apache vs nginx

apache，通过多线程来支持客户端的并发，服务器资源利用率不及nginx，功能简单

Nginx，使用的是IO多路复用，读取静态文件时就是磁盘IO和网络IO的过程，使用IO多路复用是天然的优势，可以用比较少的资源，支持大的并发，可以支持万级的并发


## 事件驱动编程原理与实现

epoll机制是Linux内核的一种内核微调机制，为了处理大量文件描述符而诞生。

- 套接字文件描述符fd
- 向操作系统注册关注事件
- 读/写事件就绪逻辑

老师的代码例子是在一个线程里完成的

一个线程就支持来自客户端的连接，完成并发
相比于多线程的并发，占用更少的资源，减少上下文切换

