# 实操商品管理

## 电商项目面试之商品管理

SPU和SKU

商品模块最关键大的是要把商品信息保存明白
SPU：标准化产品单元，是产品的公共信息
SKU：库存度量单位，商品最小存货单元

## 面试问题

- 你能解释下SKU和SPU吗？
- 如果删除SPU，那么SKU记录怎么处理
- 做的是单商铺还是多商铺
- 如何避免客户投诉的时候上架随意篡改信息
- 删除商品信息用物理删除还是逻辑删除
- 怎么提高商铺信息的加载速度？（数据库索引优化，增加连接数量，数据库集群，分库分表，引入缓存，BIO改成NIO，少量线程处理更多请求，负载均衡，CDN，减少HTTP请求）
- 你的商品系统是否支持顾客根据参数查找商品（es）
- 既然用了ES技术，SKU数据表还有什么意义
- 如果用户查询最好看的全面屏手机，你怎么实现？（中文分词技术，提取名词，忽略形容词）
- 存放商品图片你用的是什么图床（腾讯云对象存储）

MySQL的记录超过2000万时，性能就会很差，这时候要做冷热数据分离

## 秒杀

### 解决数据库超售方案

把事务的隔离级别设置成串行（Serializable）
(效率低，不可取)

修改库存的时候对记录加锁（悲观锁）
（容易产生死锁）

使用乐观锁机制，可以解决超售现象，还能避免死锁
乐观锁通过版本号来判定提交的更新操作是否有冲突

并发修改同一条记录的数据表才需要乐观锁

### Redis超售现象的原因

虽然Redis是单线程执行，但是也出现超售现象
一组业务命令发送给Redis执行，如果这些指令被插队，就会出现超售现象

Redis事务机制
- Redis的事务机制与数据库事务完全不同，Redis的事务是一组批处理命令
- 因为客户端将多条指令一次性发送给redis，而且redis是单线程执行，所以不存在被其他命令打断执行

Redis事务的乐观锁
- 客户端提交批处理命令之前，需要先查询Redis上面数据版本号

## 面试问题

- 如果让你设计一个秒杀系统，你会怎么设计？（悲观锁，限流，事务）
- 商品秒杀活动很容易出现超售现象，你会怎么解决

